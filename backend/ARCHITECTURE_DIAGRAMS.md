# Authentication System - Visual Architecture

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT APPLICATION                       â”‚
â”‚                    (Frontend / Mobile App)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ HTTP Requests with JWT Token
             â”‚ (Authorization: Bearer <token>)
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND API SERVER                          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    EXPRESS.js                             â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  auth.routes   â”‚  â”‚ user.routes  â”‚  â”‚auth-mux     â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚           â”‚                                                â”‚   â”‚
â”‚  â”‚           â–¼                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚      MIDDLEWARE STACK                      â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  errorHandler (bottom)               â”‚  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â†‘                                    â”‚  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  authMiddleware (if protected route) â”‚  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â†‘                                    â”‚  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  roleMiddleware (optional RBAC)      â”‚  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â†‘                                    â”‚  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Route Handler                       â”‚  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚           â”‚                                                â”‚   â”‚
â”‚  â”‚           â–¼                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚        CONTROLLERS                     â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ AuthController                   â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - login()                       â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - logout()                      â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - getLoginHistory()             â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚           â”‚                                                â”‚   â”‚
â”‚  â”‚           â–¼                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚        SERVICES                        â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ AuthService                      â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - login() {                     â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    - validateUser()              â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    - generateToken()             â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    - logLoginEvent()             â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  }                               â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - logout() {                    â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    - logLogoutEvent()            â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  }                               â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - getLoginHistory()             â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚           â”‚                                                â”‚   â”‚
â”‚  â”‚           â–¼                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚     REPOSITORIES                       â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ UserRepository                   â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - createUser()                  â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - getUserByEmail()              â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - updateUser()                  â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ AuditLogRepository               â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - createAuditLog()              â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - getLoginLogsByUser()          â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - getAuditLogsByAction()        â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚           â”‚                                                â”‚   â”‚
â”‚  â”‚           â–¼                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚     UTILITIES                          â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ jwt.ts                           â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - generateToken()               â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - verifyToken()                 â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - decodeToken()                 â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ password.ts                      â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - hashPassword()                â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - comparePassword()             â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ appError.ts                      â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - AppError                      â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - UnauthorizedError             â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - BadRequestError               â”‚  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE (PostgreSQL)                         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      User Table      â”‚  â”‚     AuditLog Table             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ id (UUID)            â”‚  â”‚ id (UUID)                      â”‚   â”‚
â”‚  â”‚ email                â”‚  â”‚ action ('login', 'logout')     â”‚   â”‚
â”‚  â”‚ password (hashed)    â”‚  â”‚ module ('users')               â”‚   â”‚
â”‚  â”‚ firstName            â”‚  â”‚ userId (FK to User)            â”‚   â”‚
â”‚  â”‚ lastName             â”‚  â”‚ ipAddress                      â”‚   â”‚
â”‚  â”‚ role                 â”‚  â”‚ userAgent                      â”‚   â”‚
â”‚  â”‚ lastLogin (DateTime) â”‚  â”‚ createdAt (DateTime)           â”‚   â”‚
â”‚  â”‚ accountStatus        â”‚  â”‚                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Request/Response Flow

### 1. LOGIN FLOW

```
CLIENT                          SERVER                          DATABASE
  â”‚                                â”‚                                â”‚
  â”‚â”€â”€â”€ POST /login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                                â”‚
  â”‚     {email, password}       â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ findUserByEmail()            â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ User object â”€â”€â”€â”€â”€â”€â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ comparePassword()             â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ generateToken()               â”‚
  â”‚                             â”‚   â”‚  (with user & role info)       â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ updateUser(lastLogin)        â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ createAuditLog('login')      â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚<â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                                â”‚
  â”‚     {token, user}           â”‚   â”‚                                â”‚
  â”‚
  â””â”€â”€ Store token in localStorage
```

### 2. PROTECTED REQUEST FLOW

```
CLIENT                          SERVER                          DATABASE
  â”‚                                â”‚                                â”‚
  â”‚â”€â”€â”€ GET /protected â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                                â”‚
  â”‚     Authorization: Bearer   â”‚   â”‚                                â”‚
  â”‚     <token>                 â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ authMiddleware()              â”‚
  â”‚                             â”‚   â”‚  - Extract token               â”‚
  â”‚                             â”‚   â”‚  - verifyToken()               â”‚
  â”‚                             â”‚   â”‚  - Decode payload              â”‚
  â”‚                             â”‚   â”‚  - Attach user to request      â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ Continue to route handler     â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚<â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                                â”‚
  â”‚     {data}                 â”‚   â”‚                                â”‚
```

### 3. LOGOUT FLOW

```
CLIENT                          SERVER                          DATABASE
  â”‚                                â”‚                                â”‚
  â”‚â”€â”€â”€ POST /logout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                                â”‚
  â”‚     Authorization: Bearer   â”‚   â”‚                                â”‚
  â”‚     <token>                 â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ authMiddleware()              â”‚
  â”‚                             â”‚   â”‚  - Verify token                â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€ createAuditLog('logout')     â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚                             â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                             â”‚   â”‚                                â”‚
  â”‚<â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚                                â”‚
  â”‚     {message}               â”‚   â”‚                                â”‚
  â”‚
  â””â”€â”€ Remove token from localStorage
```

---

## ğŸ”„ Authentication State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOGGED    â”‚
â”‚   OUT      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ POST /register (optional)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REGISTERED â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ POST /login (success)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     LOGGED IN                  â”‚
â”‚ (JWT Token Valid & Stored)     â”‚
â”‚ (Active session in browser)    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜
      â”‚          â”‚              â”‚
      â”‚          â”‚              â”‚
  refresh    20 min      POST /logout
   token     later        (explicit)
      â”‚          â”‚              â”‚
      â”‚          â–¼              â”‚
      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
      â”‚      â”‚ TOKEN      â”‚     â”‚
      â”‚      â”‚ EXPIRED    â”‚     â”‚
      â”‚      â”‚ (auto      â”‚     â”‚
      â”‚      â”‚  redirect) â”‚     â”‚
      â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
      â”‚            â”‚            â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ LOGGED OUT â”‚
         â”‚ (no token) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” JWT Token Structure

```
JWT Token = Header.Payload.Signature

HEADER:
{
  "alg": "HS256",
  "typ": "JWT"
}

PAYLOAD:
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "email": "john.doe@example.com",
  "role": "EMPLOYEE",
  "firstName": "John",
  "lastName": "Doe",
  "iat": 1674123456,
  "exp": 1674209856
}

SIGNATURE:
HMAC256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret_key
)
```

---

## ğŸ“Š Audit Log Entry Structure

```
AuditLog Record:
{
  id: UUID,
  action: "login" | "logout",
  module: "users",
  tableName: "user",
  recordId: "user-id",
  userId: "user-id",
  ipAddress: "192.168.1.1",
  userAgent: "Mozilla/5.0...",
  createdAt: "2025-01-24T12:30:45.000Z"
}
```

---

## ğŸ¯ Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Request received               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validation                     â”‚
â”‚  (Input checking)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    Yes  â”‚ No (error)
         â”‚        â”‚
         â–¼        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Process  â”‚  â”‚BadRequestError       â”‚
   â”‚Request  â”‚  â”‚(400)                 â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚
        â–¼                   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
   â”‚Authorization    â”‚      â”‚
   â”‚(Token/Auth)     â”‚      â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
        â”‚                   â”‚
   Yes  â”‚ No (error)        â”‚
        â”‚        â”‚          â”‚
        â–¼        â–¼          â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Auth  â”‚ â”‚UnauthorizedError     â”‚
   â”‚OK    â”‚ â”‚(401)                 â”‚
   â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚
      â–¼                    â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
   â”‚Business  â”‚            â”‚
   â”‚Logic     â”‚            â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
        â”‚                  â”‚
   OK?  â”‚ Error            â”‚
        â”‚    â”‚             â”‚
        â–¼    â–¼             â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚ Success              â”‚â”‚
   â”‚ Response             â”‚â”‚
   â”‚ (200/201)            â”‚â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
                    â–¼                 â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚Send      â”‚      â”‚Error       â”‚
              â”‚Response  â”‚      â”‚Response    â”‚
              â”‚to Client â”‚      â”‚to Client   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This visual guide helps understand how all the components work together to provide a complete authentication system!
